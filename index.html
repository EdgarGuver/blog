<!DOCTIPE html>
<hlml>
    <head>
    <meta charset="utf8">
       <title>Мой первый блог</title> 
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
    </head> 
    <body>
        <div class="container">
            <h1>Мой первый блог</h1>
            <div>
                <div class="article">
                    <h3>Что нам стоит CDN построить</h3>
                    <em>Опубликовано: 2017-05-20</em>
                    <p>Медленные сайты раздражают пользователей. Когда основной контент — фоточки, а сайт тормозит — это раздражает вдвойне. И как бы мы ни оптимизировали свой сервис, всегда остаётся такой фактор, как качество связи между пользователем и нашим ЦОДом. В решении этой проблемы нам помогает CDN.

Мы — это компания «Колёса Крыша Маркет», разработчик самых крупных и посещаемых сайтов частных объявлений в Казахстане и фотографии из объявлений — критически важная часть нашего бизнеса.

Специфика Казахстанского интернет-пространства такова — в стране есть несколько крупных интернет-провайдеров, достаточно жёстко конкурирующих между собой. Помимо доступа к сети они также предоставляют услуги colocation и с целью монополизации крайне неохотно строят пиринг между собой. Страна при этом большая и потоки трафика между городами частенько проходят очень неожиданными и совсем не оптимальными маршрутами.

В этих условиях нам нужно максимально быстро отдать пользователям 1.5 Гбит/сек фотографий автомобилей, недвижимости и товаров личного потребления.

Мы искали публичный CDN под свои нужды и нашли только присутствующий в Алматы Akamai без каких-либо подробностей по стоимости и планах расширения на остальную часть Казахстана. Мы приняли решение строить свой.

Первой идеей было получить по ip-адресу пользователя его географическое положение и отдать ему данные с ближайшего сервера. Однако этот вариант был быстро отвергнут — мы вспомнили кейсы, когда трафик в соседнюю деревню идёт через 1000 км и в таком случае скорость может быть даже ниже, чем без использования CDN.

По тем же причинам не стали мы использовать и любое другое гео-позиционирование. Один из наших админов предложил «пинговать сервер из браузера», что и послужило отправной точкой в реализации текущей схемы.

Мы построили свой CDN на связке OpenResty и Lua с использованием JavaScript. Это не потребовало никаких доработок в коде сайтов (менеджеры и разработчики рады — можно «пилить» фичи вместо инфраструктурных задач :)) и немножко «допилов» в мобильных приложениях.

OpenResty — это прекрасный форк Nginx от китайских разработчиков, о котором неоднократно писали на Хабре. Мы использовали его в качестве реверс-прокси.

Lua — простой, мощный, встраиваемый язык, который тоже получил достаточно внимания на Хабре.

При первом заходе пользователя на сайт (запуске мобильного приложения) мы определяем хост, с которого пользователь получает данные максимально быстро. На сайте для этого в ответ сервера встраивается небольшой код на JavaScript (в мобильных приложениях эту логику пришлось реализовать дополнительно). Он, в свою очередь, встраивает в страницу по одной невидимой картинке с каждого из хостов CDN и замеряет время, за которое эта картинка была получена. По результатам измерений пользователю на основной домен ставится кука с именем самого быстрого хоста.</p>
                </div>
                <div class="article">
                    <h3>Терминология. Борьба со сложностью</h3>
                    <em>Опубликовано: 2017-05-20</em>
                    <p>Терминология — это важнейшая вещь в любом деле. Не договорившись о терминах невозможно преуспеть. Что с этим в программировании? В частности в Java? Не очень хорошо, если не сказать плохо.

Кажется нет четкой договоренности даже о базовых терминах. Например, если я скажу «внутренний класс», о чем вы подумаете? Держу пари, будет больше чем один вариант того что имеется в виду. И это очень плохо т.к. создает трудности в общении и не только.

Как исправляется такая ситуация обычно — выпускаются ГОСТы. Эти ГОСТы имеют приписку «Термины и определения». Например — ГОСТ Р 7.0.8.-2013 «Делопроизводство и архивное дело — Термины и определения».

Но ГОСТы это же скучно. Поэтому ниже я приведу свой вклад в устранение хаоса, хотя бы по части терминологии в отношении классов Java.

Итак, в Java есть классы:

«Лучезарный» — все классы являются «лучезарными». Если вы скажете «я написал лучезарный класс», то это будет означать что это какой-то класс из нижеперечисленных, только и всего. Все нижеперечисленные классы «лучезарны»!

«Парящий» — это класс, описание которого начинается сразу после разделов «package» и «import» исходного .java-файла.
«Крадущийся» — крадущиеся классы 'живут' (определяются) только внутри «парящих». Это обобщающее понятие для нижеперечисленных видов классов.

«Испепеляющий» — это статический класс объявленный непосредственно внутри «крадущегося»
«Пронзающий» — это НЕ статический класс объявленный непосредственно внутри «крадущегося»
«Тенеподобный» — это анонимный класс
«Рыскающий» — это локальный класс. Объявляется в блоках кода (в методах классов), впрочем как и «тенеподобный»

Уточнение на всякий случай: в этой схеме «Лучезарный» — это обобщение для всех видов классов вообще, а «Крадущийся» — это обобщение для всех тех «Лучезарных» классов которые не являются «Парящими».</p>
                </div>
            </div>
            <footer>
                <p>Мой первый Блог <br>Copyright &copy; 2015</p>
            </footer>
        </div>

    </body>
</hlml>